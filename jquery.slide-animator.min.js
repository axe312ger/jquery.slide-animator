!function(i,t,s,n){function e(t,s){var n,e=0/0,a=0/0;if(this.$element=i(t),this.options=i.extend({},o,s),this.slides=[],this.defaultSlide={url:"",options:{},preLoaded:!1},this.currentSlide=0,this.$frontSlide=null,this.$backSlide=null,this.animating=!1,"undefined"===this.options.src||"undefined"==typeof this.options.animationClass||"undefined"==typeof this.options.urlParam)throw new Error("Missing required options. Check the docs.");if(n=i("<div/>").addClass(this.options.animationClass).hide().appendTo(i("body")),e=1e3*parseFloat(n.css("animation-duration")),a=1e3*parseFloat(n.css("-webkit-animation-duration")),n.remove(),isNaN(e)){if(isNaN(a))throw new Error("Can not read animation duration. Check the docs.");this.animationDuration=a}else this.animationDuration=e;this.init()}var a="slideAnimator",o={template:"<figure>{{img}}<figcaption>{{caption}}</figcaption></figure>",cssClass:"jquery-slide-animator",animatingClass:"animating",root:"slides",child:"slide",preLoadImages:5,loop:!0,shuffle:!1,autostart:!0,fitToContainer:!0,backgroundImage:!1,animateBackslide:!1,onAnimationStart:!1,onAnimationEnd:!1};e.prototype={init:function(){this.$frontSlide=i('<div class="frontSlide"/>'),this.$backSlide=i('<div class="backSlide"/>'),this.$element.addClass(this.options.cssClass).append(this.$frontSlide).append(this.$backSlide),i.ajax({dataType:"json",url:this.options.src,context:this,success:this.prepareSlides,error:function(i){throw new Error("Could not load json file: "+i.status+" - "+i.statusText)}})},prepareSlides:function(t){var s=this;i.each(t[this.options.root],function(t,n){var e,a,o=s.options.urlParam.split("."),r=n[s.options.child];if(o.forEach(function(i){r=r[i]||{}}),"string"!=typeof r)throw new Error("Cannot locate image url for image #"+t);e=r,a=i.extend({},s.defaultSlide,{url:e,options:n[s.options.child]}),s.slides.push(a)}),this.options.shuffle&&this.shuffleSlides(),this.options.preLoadImages>0?this.preLoad():this.options.autostart&&this.startAnimation()},preLoad:function(){var t,s,n=this.options.autostart,e=this;t=Object.keys(this.slides).slice(this.currentSlide,this.options.preLoadImages),s=t.length,i.each(t,function(t){var a=i("<img/>"),o=function(){s--,a.unbind("load",o),0===s&&e.startAnimation()},r=function(){e.slides[t].preLoaded=!0,e.slides[t].naturalWidth=this.naturalWidth,e.slides[t].naturalHeight=this.naturalHeight,a.unbind("load",r),a.remove()};return e.slides[t].preLoaded?void(n&&o()):(n&&a.bind("load",o),a.bind("load",r),void a.attr("src",e.slides[t].url))})},preLoadSlide:function(t){var s=i("<img/>"),n=this,e=function(){n.slides[t].preLoaded=!0,n.slides[t].naturalWidth=this.naturalWidth,n.slides[t].naturalHeight=this.naturalHeight,s.unbind("load",e),s.remove(),n.startAnimation()};return this.slides[t].preLoaded?void this.startAnimation():(s.bind("load",e),void s.attr("src",this.slides[t].url))},startAnimation:function(){var t,s,n,e,a,o;if(!this.animating){if(this.currentSlide===this.slides.length-1&&!this.options.loop)return this.animating=!1,void this.$element.removeClass(this.options.animatingClass);if(e=this.currentSlide,s=this.slides[e],a=this.currentSlide<this.slides.length-1?this.currentSlide+1:0,n=this.slides[a],n.preLoaded===!1)return void this.preLoadSlide(a);o=a+1,o>=this.slides.length-1&&(o=0),this.slides[o].preLoaded===!1&&this.preLoadSlide(o),this.$frontSlide.is(":empty")?(t=this.generateSlide(i("<img/>").attr("src",s.url),s),this.$frontSlide.append(t)):this.$frontSlide.empty().append(this.$backSlide.children()),t=this.generateSlide(i("<img/>").attr("src",n.url),n),this.$backSlide.append(t),this.animating=!0,this.$element.addClass(this.options.animatingClass),this.$frontSlide.find(".animated-image").addClass(this.options.animationClass),this.options.animateBackslide&&this.$backSlide.find(".animated-image").addClass(this.options.animationClass),this.options.onAnimationStart&&this.options.onAnimationStart(this.currentSlide,this.$frontSlide,this.$backSlide),setTimeout(this.finishAnimation.bind(this),this.animationDuration)}},finishAnimation:function(){this.currentSlide===this.slides.length-1?this.currentSlide=0:this.currentSlide++,this.animating=!1,this.options.onAnimationEnd&&this.options.onAnimationEnd(this.currentSlide,this.$frontSlide,this.$backSlide),this.startAnimation()},generateSlide:function(t,s){var n,e,a=this.options.template,o=function(){var i=this.$element.innerWidth(),t=this.$element.innerHeight(),n=s.naturalWidth,e=s.naturalHeight,a=i/n,o=t/e,r=a>o?a:o;if(0===i||0===t)throw new Error("Can not fit to container since width or height are equal 0.Please check your css.");return n=r*n,e=r*e,{width:n,height:e}};return this.options.backgroundImage?(t=i("<div/>").css("background-image","url("+t.attr("src")+")"),this.options.fitToContainer&&t.css("background-size","cover")):this.options.fitToContainer?(e=o.call(this),t.width(e.width),t.height(e.height),t.css("margin-left",e.width/2*-1),t.css("margin-top",e.height/2*-1)):(t.css("margin-left",s.naturalWidth/2*-1),t.css("margin-top",s.naturalHeight/2*-1)),t.addClass("animated-image"),a=a.replace(/\{\{img\}\}/g,t.get(0).outerHTML),Object.keys(s.options).forEach(function(i){n=new RegExp("\\{\\{"+i+"\\}\\}","g"),a=a.replace(n,s.options[i])}),a=a.replace(/\{\{[^}]+\}\}/g,""),i(a)},shuffleSlides:function(){for(var i,t,s=this.slides.length;s>0;)t=Math.floor(Math.random()*s),s--,i=this.slides[s],this.slides[s]=this.slides[t],this.slides[t]=i},nextSlide:function(){this.finishAnimation()},start:function(){this.animating=!1,this.startAnimation()}},i.fn[a]=function(t){return this.each(function(){i.data(this,"plugin_"+a)||i.data(this,"plugin_"+a,new e(this,t))})}}(jQuery,window,document);